<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Memoise a function — memoise • memoise</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Memoise a function — memoise" />
<meta property="og:description" content="mf &amp;lt;- memoise(f) creates mf, a memoised copy of
f. A memoised copy is basically a
lazier version of the same function: it saves the answers of
new invocations, and re-uses the answers of old ones. Under the right
circumstances, this can provide a very nice speedup indeed." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">memoise</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/memoise/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Memoise a function</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/memoise/blob/master/R/memoise.R'><code>R/memoise.R</code></a></small>
    <div class="hidden name"><code>memoise.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>mf &lt;- memoise(f)</code> creates <code>mf</code>, a memoised copy of
<code>f</code>. A memoised copy is basically a
lazier version of the same function: it saves the answers of
new invocations, and re-uses the answers of old ones. Under the right
circumstances, this can provide a very nice speedup indeed.</p>
    </div>

    <pre class="usage"><span class='fu'>memoise</span><span class='op'>(</span>
  <span class='va'>f</span>,
  <span class='va'>...</span>,
  envir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>environment</a></span><span class='op'>(</span><span class='va'>f</span><span class='op'>)</span>,
  cache <span class='op'>=</span> <span class='fu'>cachem</span><span class='fu'>::</span><span class='fu'><a href='https://cachem.r-lib.org/reference/cache_mem.html'>cache_mem</a></span><span class='op'>(</span>max_size <span class='op'>=</span> <span class='fl'>1024</span> <span class='op'>*</span> <span class='fl'>1024</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>,
  omit_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>)</span>,
  hash <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'>rlang</span><span class='fu'>::</span><span class='fu'><a href='https://rlang.r-lib.org/reference/hash.html'>hash</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>f</th>
      <td><p>Function of which to create a memoised copy.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>optional variables to use as additional restrictions on
caching, specified as one-sided formulas (no LHS). See Examples for usage.</p></td>
    </tr>
    <tr>
      <th>envir</th>
      <td><p>Environment of the returned function.</p></td>
    </tr>
    <tr>
      <th>cache</th>
      <td><p>Cache object. The default is a [cachem::cache_mem()] with a max
size of 1024 MB.</p></td>
    </tr>
    <tr>
      <th>omit_args</th>
      <td><p>Names of arguments to ignore when calculating hash.</p></td>
    </tr>
    <tr>
      <th>hash</th>
      <td><p>A function which takes an R object as input and returns a string
which is used as a cache key.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>There are two main ways to use the <code>memoise</code> function. Say that
you wish to memoise <code>glm</code>, which is in the <code>stats</code>
package; then you could use <br />
  <code>  mem_glm &lt;- memoise(glm)</code>, or you could use<br />
  <code>  glm &lt;- memoise(stats::glm)</code>. <br />
The first form has the advantage that you still have easy access to
both the memoised and the original function. The latter is especially
useful to bring the benefits of memoisation to an existing block
of R code.</p>
<p>Two example situations where <code>memoise</code> could be of use:</p><ul>
<li><p>You're evaluating a function repeatedly over the rows (or
    larger chunks) of a dataset, and expect to regularly get the same
    input.</p></li>
<li><p>You're debugging or developing something, which involves
    a lot of re-running the code.  If there are a few expensive calls
    in there, memoising them can make life a lot more pleasant.
    If the code is in a script file that you're <code><a href='https://rdrr.io/r/base/source.html'>source()</a></code>ing,
    take care that you don't just put <br />
      <code>  glm &lt;- memoise(stats::glm)</code> <br />
    at the top of your file: that would reinitialise the memoised
    function every time the file was sourced. Wrap it in <br />
      <code>  if (!is.memoised(glm)) </code>, or do the memoisation call
    once at the R prompt, or put it somewhere else where it won't get
    repeated.</p></li>
</ul>

<p>It is recommended that functions in a package are not memoised at build-time,
but when the package is loaded. The simplest way to do this is within
<code><a href='https://rdrr.io/r/base/ns-hooks.html'>.onLoad()</a></code> with, for example</p>

<pre>
<span class='co'># file.R</span>
<span class='va'>fun</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
 <span class='fu'>some_expensive_process</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># zzz.R</span>
<span class='va'>.onLoad</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>libname</span>, <span class='va'>pkgname</span><span class='op'>)</span> <span class='op'>{</span>
 <span class='va'>fun</span> <span class='op'>&lt;&lt;-</span> <span class='fu'>memoise</span><span class='fu'>::</span><span class='fu'>memoise</span><span class='op'>(</span><span class='va'>fun</span><span class='op'>)</span>
<span class='op'>}</span>
</pre>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='forget.html'>forget</a></code>, <code><a href='is.memoised.html'>is.memoised</a></code>,
  <code><a href='timeout.html'>timeout</a></code>, <a href='https://en.wikipedia.org/wiki/Memoization'>https://en.wikipedia.org/wiki/Memoization</a>,
  <code><a href='drop_cache.html'>drop_cache</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># a() is evaluated anew each time. memA() is only re-evaluated</span>
<span class='co'># when you call it with a new set of parameters.</span>
<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>{</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>}</span>
<span class='va'>memA</span> <span class='op'>&lt;-</span> <span class='fu'>memoise</span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>replicate</a></span><span class='op'>(</span><span class='fl'>5</span>, <span class='fu'>a</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;           [,1]        [,2]      [,3]      [,4]      [,5]
#&gt; [1,] 0.6007609 0.007399441 0.4977774 0.7328820 0.8746007
#&gt; [2,] 0.1572084 0.466393497 0.2897672 0.7725215 0.1749406</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>replicate</a></span><span class='op'>(</span><span class='fl'>5</span>, <span class='fu'>memA</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;            [,1]       [,2]       [,3]       [,4]       [,5]
#&gt; [1,] 0.03424133 0.03424133 0.03424133 0.03424133 0.03424133
#&gt; [2,] 0.32038573 0.32038573 0.32038573 0.32038573 0.32038573</div><div class='input'>
<span class='co'># Caching is done based on parameters' value, so same-name-but-</span>
<span class='co'># changed-value correctly produces two different outcomes...</span>
<span class='va'>N</span> <span class='op'>&lt;-</span> <span class='fl'>4</span>; <span class='fu'>memA</span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.40232824 0.19566983 0.40353812 0.06366146</div><div class='input'><span class='va'>N</span> <span class='op'>&lt;-</span> <span class='fl'>5</span>; <span class='fu'>memA</span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.3887013 0.9755478 0.2898923 0.6783804 0.7353196</div><div class='input'><span class='co'># ... and same-value-but-different-name correctly produces</span>
<span class='co'>#     the same cached outcome.</span>
<span class='va'>N</span> <span class='op'>&lt;-</span> <span class='fl'>4</span>; <span class='fu'>memA</span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.40232824 0.19566983 0.40353812 0.06366146</div><div class='input'><span class='va'>N2</span> <span class='op'>&lt;-</span> <span class='fl'>4</span>; <span class='fu'>memA</span><span class='op'>(</span><span class='va'>N2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.40232824 0.19566983 0.40353812 0.06366146</div><div class='input'>
<span class='co'># memoise() knows about default parameters.</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>n</span>, <span class='va'>dummy</span><span class='op'>=</span><span class='st'>"a"</span><span class='op'>)</span> <span class='op'>{</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>}</span>
<span class='va'>memB</span> <span class='op'>&lt;-</span> <span class='fu'>memoise</span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span>
<span class='fu'>memB</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.1959567 0.9805397</div><div class='input'><span class='fu'>memB</span><span class='op'>(</span><span class='fl'>2</span>, dummy<span class='op'>=</span><span class='st'>"a"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.1959567 0.9805397</div><div class='input'><span class='co'># This works, because the interface of the memoised function is the same as</span>
<span class='co'># that of the original function.</span>
<span class='fu'><a href='https://rdrr.io/r/base/formals.html'>formals</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $n
#&gt; 
#&gt; 
#&gt; $dummy
#&gt; [1] "a"
#&gt; </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/formals.html'>formals</a></span><span class='op'>(</span><span class='va'>memB</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $n
#&gt; 
#&gt; 
#&gt; $dummy
#&gt; [1] "a"
#&gt; </div><div class='input'><span class='co'># However, it doesn't know about parameter relevance.</span>
<span class='co'># Different call means different caching, no matter</span>
<span class='co'># that the outcome is the same.</span>
<span class='fu'>memB</span><span class='op'>(</span><span class='fl'>2</span>, dummy<span class='op'>=</span><span class='st'>"b"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.74152153 0.05144628</div><div class='input'>
<span class='co'># You can create multiple memoisations of the same function,</span>
<span class='co'># and they'll be independent.</span>
<span class='fu'>memA</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.03424133 0.32038573</div><div class='input'><span class='va'>memA2</span> <span class='op'>&lt;-</span> <span class='fu'>memoise</span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>
<span class='fu'>memA</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>  <span class='co'># Still the same outcome</span>
</div><div class='output co'>#&gt; [1] 0.03424133 0.32038573</div><div class='input'><span class='fu'>memA2</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span> <span class='co'># Different cache, different outcome</span>
</div><div class='output co'>#&gt; [1] 0.5302125 0.6958239</div><div class='input'>
<span class='co'># Multiple memoized functions can share a cache.</span>
<span class='va'>cm</span> <span class='op'>&lt;-</span> <span class='fu'>cachem</span><span class='fu'>::</span><span class='fu'><a href='https://cachem.r-lib.org/reference/cache_mem.html'>cache_mem</a></span><span class='op'>(</span>max_size <span class='op'>=</span> <span class='fl'>50</span> <span class='op'>*</span> <span class='fl'>1024</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
<span class='va'>memA</span> <span class='op'>&lt;-</span> <span class='fu'>memoise</span><span class='op'>(</span><span class='va'>a</span>, cache <span class='op'>=</span> <span class='va'>cm</span><span class='op'>)</span>
<span class='va'>memB</span> <span class='op'>&lt;-</span> <span class='fu'>memoise</span><span class='op'>(</span><span class='va'>b</span>, cache <span class='op'>=</span> <span class='va'>cm</span><span class='op'>)</span>

<span class='co'># Don't do the same memoisation assignment twice: a brand-new</span>
<span class='co'># memoised function also means a brand-new cache, and *that*</span>
<span class='co'># you could as easily and more legibly achieve using forget().</span>
<span class='co'># (If you're not sure whether you already memoised something,</span>
<span class='co'>#  use is.memoised() to check.)</span>
<span class='fu'>memA</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.68855600 0.03123033</div><div class='input'><span class='va'>memA</span> <span class='op'>&lt;-</span> <span class='fu'>memoise</span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>
<span class='fu'>memA</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.2255625 0.3008308</div><div class='input'>
<span class='co'># Make a memoized result automatically time out after 10 seconds.</span>
<span class='va'>memA3</span> <span class='op'>&lt;-</span> <span class='fu'>memoise</span><span class='op'>(</span><span class='va'>a</span>, cache <span class='op'>=</span> <span class='fu'>cachem</span><span class='fu'>::</span><span class='fu'><a href='https://cachem.r-lib.org/reference/cache_mem.html'>cache_mem</a></span><span class='op'>(</span>max_age <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>memA3</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.6364656 0.4790245</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, Jim Hester, Winston Chang, Kirill Müller, Daniel Cook.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


