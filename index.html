<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memoisation of Functions • memoise</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Memoisation of Functions">
<meta property="og:description" content="Cache the results of a function so that when you
    call it again with the same arguments it returns the pre-computed
    value.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">memoise</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/memoise/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="memoise" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#memoise" class="anchor"></a>memoise</h1></div>
<!-- badges: start -->

<p>The memoise package makes it easy to memoise R functions. <strong>Memoisation</strong> (<a href="https://en.wikipedia.org/wiki/Memoization" class="uri">https://en.wikipedia.org/wiki/Memoization</a>) caches function calls so that if a previously seen set of inputs is seen, it can return the previously computed output.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>Install from CRAN with</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"memoise"</span><span class="op">)</span></code></pre></div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>To memoise a function, use <code><a href="reference/memoise.html">memoise()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/memoise">memoise</a></span><span class="op">)</span>
<span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">mf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/memoise.html">memoise</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">mf</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed</span>
<span class="co">#&gt;   0.002   0.000   1.003</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">mf</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed</span>
<span class="co">#&gt;   0.000   0.000   0.001</span></code></pre></div>
<p>You can clear <code>mf</code>’s cache with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/forget.html">forget</a></span><span class="op">(</span><span class="va">mf</span><span class="op">)</span></code></pre></div>
<p>And you can test whether a function is memoised with <code><a href="reference/is.memoised.html">is.memoised()</a></code>.</p>
</div>
<div id="caches" class="section level2">
<h2 class="hasAnchor">
<a href="#caches" class="anchor"></a>Caches</h2>
<p>By default, memoise uses an in-memory cache, using <code>cache_mem()</code> from the <a href="https://cachem.r-lib.org/">cachem</a> package. <code><a href="https://cachem.r-lib.org/reference/cache_disk.html">cachem::cache_disk()</a></code> allows caching using files on a local filesystem.</p>
<p>Both <code><a href="https://cachem.r-lib.org/reference/cache_mem.html">cachem::cache_mem()</a></code> and <code><a href="https://cachem.r-lib.org/reference/cache_disk.html">cachem::cache_disk()</a></code> support automatic pruning by default; this means that they will not keep growing past a certain size, and eventually older items will be removed from the cache. The default size <code>cache_mem()</code> is 512 MB, and the default size for a <code>cache_disk()</code> is 1 GB, but this can be customized by specifying <code>max_size</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 100 MB limit</span>
<span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu">cachem</span><span class="fu">::</span><span class="fu"><a href="https://cachem.r-lib.org/reference/cache_mem.html">cache_mem</a></span><span class="op">(</span>max_size <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>

<span class="va">mf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/memoise.html">memoise</a></span><span class="op">(</span><span class="va">f</span>, cache <span class="op">=</span> <span class="va">cm</span><span class="op">)</span></code></pre></div>
<p>You can also change the maximum age of items in the cache with <code>max_age</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Expire items in cache after 15 minutes</span>
<span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu">cachem</span><span class="fu">::</span><span class="fu"><a href="https://cachem.r-lib.org/reference/cache_mem.html">cache_mem</a></span><span class="op">(</span>max_age <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span>

<span class="va">mf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/memoise.html">memoise</a></span><span class="op">(</span><span class="va">f</span>, cache <span class="op">=</span> <span class="va">cm</span><span class="op">)</span></code></pre></div>
<p>By default, a <code>cache_disk()</code> uses a subdirectory the R process’s temp directory, but it is possible to specify the directory. This is useful for persisting a cache across R sessions, sharing a cache among different processes, or even for synchronizing across the network.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Store in "R-myapp" directory inside of user-level cache directory</span>
<span class="va">cd</span> <span class="op">&lt;-</span> <span class="fu">cachem</span><span class="fu">::</span><span class="fu"><a href="https://cachem.r-lib.org/reference/cache_disk.html">cache_disk</a></span><span class="op">(</span><span class="fu">rappdirs</span><span class="fu">::</span><span class="fu">user_cache_dir</span><span class="op">(</span><span class="st">"R-myapp"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Store in Dropbox</span>
<span class="va">cdb</span> <span class="op">&lt;-</span> <span class="fu">cachem</span><span class="fu">::</span><span class="fu"><a href="https://cachem.r-lib.org/reference/cache_disk.html">cache_disk</a></span><span class="op">(</span><span class="st">"~/Dropbox/.rcache"</span><span class="op">)</span></code></pre></div>
<p>A single cache object can be shared among multiple memoised functions. By default, the cache key includes not only the arguments to the function, but also the body of the function. This essentially eliminates the possibility of a cache collision, even if two memoised functions are called with the same arguments.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">cachem</span><span class="fu">::</span><span class="fu"><a href="https://cachem.r-lib.org/reference/cache_mem.html">cache_mem</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">times2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/memoise.html">memoise</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">}</span>, cache <span class="op">=</span> <span class="va">m</span><span class="op">)</span>
<span class="va">times4</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/memoise.html">memoise</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">4</span> <span class="op">}</span>, cache <span class="op">=</span> <span class="va">m</span><span class="op">)</span>

<span class="fu">times2</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; [1] 20</span>
<span class="fu">times4</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; [1] 40</span></code></pre></div>
<div id="cache-api" class="section level3">
<h3 class="hasAnchor">
<a href="#cache-api" class="anchor"></a>Cache API</h3>
<p>It is possible to use other caching backends with memoise. These caching objects must be key-value stores which use the same API as those from the <a href="https://cachem.r-lib.org/">cachem</a> package. The following methods are required for full compatibiltiy with memoise:</p>
<ul>
<li>
<code>$set(key, value)</code>: Sets a <code>key</code> to <code>value</code> in the cache.</li>
<li>
<code>$get(key)</code>: Gets the value associated with <code>key</code>. If the key is not in the cache, this returns an object with class <code>"key_missing"</code>.</li>
<li>
<code>$exists(key)</code>: Checks for the existence of <code>key</code> in the cache.</li>
<li>
<code>$remove(key)</code>: Removes the value for <code>key</code> from the cache.</li>
<li>
<code>$reset()</code>: Resets the cache, clearing all key/value pairs.</li>
</ul>
<p>Note that the sentinel value for missing keys can be created by calling <code><a href="https://r-lib.github.io/fastmap/reference/key_missing.html">cachem::key_missing()</a></code>, or <code><a href="https://rdrr.io/r/base/structure.html">structure(list(), class = "key_missing")</a></code>.</p>
</div>
<div id="old-style-cache-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#old-style-cache-objects" class="anchor"></a>Old-style cache objects</h3>
<p>Before version 2.0, memoise used different caching objects, which did not have automatic pruning and had a slightly different API. These caching objects can still be used, but we recommend using the caching objects from cachem when possible.</p>
<p>With the old-style caching objects, memoise first checks for the existence of a key in the cache, and if present, it fetches the value. This results in a possible race condition (when using caches other than the memory cache): an object could be deleted from the cache after the existence check, but before the value is fetched. With the new cachem-style caching objects, the possibility of a a race condition is eliminated: memoise simply tries to fetch the key, and if it’s not present in the cache, the cache returns a sentinel value indicating that it’s missing. (Note that the caching objects must also be designed to avoid a similar race condition internally.)</p>
<p>The following cache objects do not currently have an equivalent in cachem.</p>
<ul>
<li>
<p><code><a href="reference/cache_s3.html">cache_s3()</a></code> allows caching on <a href="https://aws.amazon.com/s3/">Amazon S3</a> Requires you to specify a bucket using <code>cache_name</code>. When creating buckets, they must be unique among all s3 users when created.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>
  <span class="st">"AWS_ACCESS_KEY_ID"</span> <span class="op">=</span> <span class="st">"&lt;access key&gt;"</span>,
  <span class="st">"AWS_SECRET_ACCESS_KEY"</span> <span class="op">=</span> <span class="st">"&lt;access secret&gt;"</span>
<span class="op">)</span>
<span class="va">cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cache_s3.html">cache_s3</a></span><span class="op">(</span><span class="st">"&lt;unique bucket name&gt;"</span><span class="op">)</span></code></pre></div>
</li>
<li>
<p><code><a href="reference/cache_gcs.html">cache_gcs()</a></code> saves the cache to Google Cloud Storage. It requires you to authenticate by downloading a JSON authentication file, and specifying a pre-made bucket:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>
  <span class="st">"GCS_AUTH_FILE"</span> <span class="op">=</span> <span class="st">"&lt;google-service-json&gt;"</span>,
  <span class="st">"GCS_DEFAULT_BUCKET"</span> <span class="op">=</span> <span class="st">"unique-bucket-name"</span>
<span class="op">)</span>
<span class="va">gcs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cache_gcs.html">cache_gcs</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</li>
</ul>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=memoise">https://​cloud.r-project.org/​package=memoise</a>
</li>
<li>Browse source code at <br><a href="https://github.com/r-lib/memoise/">https://​github.com/​r-lib/​memoise/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/r-lib/memoise/issues">https://​github.com/​r-lib/​memoise/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="http://hadley.nz">Hadley Wickham</a> <br><small class="roles"> Author </small>  </li>
<li>Jim Hester <br><small class="roles"> Author, maintainer </small>  </li>
<li>Winston Chang <br><small class="roles"> Author </small>  </li>
<li>Kirill Müller <br><small class="roles"> Author </small>  </li>
<li>Daniel Cook <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=memoise"><img src="https://www.r-pkg.org/badges/version/memoise" alt="CRAN status"></a></li>
<li><a href="https://github.com/r-lib/memoise/actions"><img src="https://github.com/r-lib/memoise/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/gh/hadley/memoise?branch=master"><img src="https://codecov.io/gh/hadley/memoise/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://hadley.nz">Hadley Wickham</a>, Jim Hester, Winston Chang, Kirill Müller, Daniel Cook.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
